<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">

<dom-module id="fnt-element">
  <template>
    <style is="custom-style">
      :host {
        display: block;
      }

      paper-material {
        padding: 30px;
        margin: 10px;
        background-color: #ffffff;
        text-align: center;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }

      #number {
        font-family: Roboto;
        font-size: 3em;
      }

      #correctIcon {
        color: var(--paper-green-500)
      }
    </style>
    <div style="text-align: center">
      <paper-material elevation="4">
        <div id="number" hidden$="{{!settings.isShow}}">[[number]]</div>
        <div hidden$="[[!settings.isShowAnswer]]">[[numeral]]</div>
        <paper-input id="userInputField" on-input="verify" value="{{userInput}}">
          <iron-icon id="correctIcon" icon="check" suffix hidden></iron-icon>
        </paper-input>
        <voice-player id="player"></voice-player>
        <paper-icon-button on-tap="_handleShow" icon="help-outline"></paper-icon-button>
        <paper-icon-button on-tap="speakNumber" icon="record-voice-over"></paper-icon-button>
      </paper-material>
    </div>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'fnt-element',

        properties: {
          number: Number,
          settings: {
            type: Object,
            notify: true
          }
        },

        attached: function () {
          this.generateNumber();
        },

        generateNumber: function () {
          this.number = Math.floor((Math.random() * (this.settings.range.to + 1)) + this.settings.range.from);
          this.numeral = writtenNumber(this.number, {lang: this.settings.lang});
          this.set('settings.isShowAnswer', false);
          if (this.settings.isSpeak) {
            this.speakNumber();
          }
        },

        speakNumber: function () {
          this.$.player.text = this.numeral;
          this.$.player.accent = this.settings.lang;
          this.$.player.speak();
        },

        verify: function () {
          if (this.numeral == this.userInput) {
            this.$.userInputField.classList.add('correct');
            this.$.correctIcon.hidden = false;
            var self = this;
            setTimeout(function () {
              self.generateNumber();
              self.clearUserInput();
              self.$.userInputField.classList.remove('correct');
              self.$.correctIcon.hidden = true;
            }, 500);
          }
        },

        clearUserInput: function () {
          this.userInput = '';
        },

        _handleShow: function () {
          this.set('settings.isShowAnswer', !this.settings.isShowAnswer);
        }
      });
    })();
  </script>
</dom-module>
